<aside class="sidebar">
  <div class="sidebar-logo" (click)="routeTODashboard()">
    <svg width="48" height="48" viewBox="0 0 120 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M28.6613 2.5523C28.3952 2.72363 28.2179 2.9916 28.2356 3.31669C29.0072 3.46605 29.7966 3.32987 30.5727 3.46605C32.1425 3.72963 33.6725 4.23923 35.0738 4.99044C38.5107 6.81355 41.1626 9.78325 43.2779 12.9814C45.7524 16.9132 47.5085 21.2535 48.7946 25.6992C48.932 26.1649 49.0518 26.6394 49.2292 27.0918C49.8057 29.6442 50.5463 32.1922 51.8722 34.4722C52.8301 36.0624 54.0674 37.5429 55.6993 38.4874C57.2426 39.4012 59.0829 39.7834 60.8701 39.6076C64.4666 39.2254 67.8724 36.9147 69.2826 33.5804C68.9633 33.7122 68.6662 33.8791 68.409 34.1075C67.2471 35.052 65.8058 35.812 64.2582 35.711C62.9233 35.7154 61.7881 34.8851 60.879 33.9977C58.7592 31.6518 57.7348 28.5723 57.0164 25.5675C56.7015 23.7795 56.1206 22.0574 55.6106 20.3178C54.6306 17.4535 53.6328 14.5805 52.2713 11.8655C52.156 11.6371 52.0363 11.4087 51.85 11.2286C51.6372 10.4466 51.0873 9.82278 50.7015 9.1199C49.5485 7.34071 48.4221 5.49124 46.799 4.08107C44.2269 1.73958 40.8388 0.281097 37.3532 0.0306935C37.0605 0.0131213 36.7678 -6.10352e-05 36.4707 -6.10352e-05C33.6813 -6.10352e-05 30.8875 0.882944 28.6613 2.55669" fill="url(#paint0_linear_40000949_1457)"/>
      <mask id="mask0_40000949_1457" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="87" y="9" width="19" height="25">
      <path d="M96.6665 10.9299C94.1344 12.5377 92.702 15.279 91.478 17.9016C90.4581 20.0279 89.9525 22.3386 89.2784 24.5878C88.7197 26.1386 88.2851 27.8035 87.2119 29.0951C87.7175 30.58 88.5556 32.0604 89.9436 32.8863C91.0168 33.4838 92.2674 33.0972 93.3583 32.7501C93.7353 32.5964 93.8905 32.1702 94.1344 31.8715C95.4027 30.1055 95.7796 27.9266 96.3473 25.8794C97.3273 22.6725 98.334 19.4436 99.9349 16.4783C100.627 15.2702 101.354 14.0489 102.405 13.1088C102.946 12.63 103.571 12.1907 104.303 12.0633C104.822 11.9578 105.323 12.1819 105.833 12.2302C105.793 11.9447 105.935 11.5493 105.638 11.3692C104.183 10.3807 102.392 9.81403 100.618 9.81403C99.2298 9.81403 97.855 10.1611 96.6665 10.9255" fill="white"/>
      </mask>
      <g mask="url(#mask0_40000949_1457)">
      <path d="M92.0351 1.72159L76.7773 27.4119L101.129 41.6043L116.386 15.914L92.0351 1.72159Z" fill="url(#paint0_linear_40000949_1457)"/>
      </g>
      <mask id="mask1_40000949_1457" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="28" y="0" width="42" height="40">
      <path d="M28.6613 2.5523C28.3952 2.72363 28.2179 2.9916 28.2356 3.31669C29.0072 3.46605 29.7966 3.32987 30.5727 3.46605C32.1425 3.72963 33.6725 4.23923 35.0738 4.99044C38.5107 6.81355 41.1626 9.78325 43.2779 12.9814C45.7524 16.9132 47.5085 21.2535 48.7946 25.6992C48.932 26.1649 49.0518 26.6394 49.2292 27.0918C49.8057 29.6442 50.5463 32.1922 51.8722 34.4722C52.8301 36.0624 54.0674 37.5429 55.6993 38.4874C57.2426 39.4012 59.0829 39.7834 60.8701 39.6076C64.4666 39.2254 67.8724 36.9147 69.2826 33.5804C68.9633 33.7122 68.6662 33.8791 68.409 34.1075C67.2471 35.052 65.8058 35.812 64.2582 35.711C62.9233 35.7154 61.7881 34.8851 60.879 33.9977C58.7592 31.6518 57.7348 28.5723 57.0164 25.5675C56.7015 23.7795 56.1206 22.0574 55.6106 20.3178C54.6306 17.4535 53.6328 14.5805 52.2713 11.8655C52.156 11.6371 52.0363 11.4087 51.85 11.2286C51.6372 10.4466 51.0873 9.82278 50.7015 9.1199C49.5485 7.34071 48.4221 5.49124 46.799 4.08107C44.2269 1.73958 40.8388 0.281097 37.3532 0.0306935C37.0605 0.0131213 36.7678 -6.10352e-05 36.4707 -6.10352e-05C33.6813 -6.10352e-05 30.8875 0.882944 28.6613 2.55669" fill="white"/>
      </mask>
      <g mask="url(#mask1_40000949_1457)">
      <path d="M41.9539 -19.1967L9.2666 26.4686L55.5378 58.9712L88.2251 13.306L41.9539 -19.1967Z" fill="url(#paint1_linear_40000949_1457)"/>
      </g>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M68.342 14.4399C71.0914 11.4307 76.1247 11.0529 79.4374 13.3416C78.6525 13.4734 77.7877 13.4603 77.127 13.9567C76.2844 14.5409 75.6015 15.3141 74.9939 16.1312C74.7722 16.3992 74.7012 16.7463 74.6391 17.0757C74.1779 17.2778 74.0538 17.7962 73.8365 18.2004C71.9074 22.3957 70.9273 26.9381 70.0404 31.441C69.8231 32.1571 69.6546 32.9302 69.2732 33.5716C68.9584 33.7034 68.6568 33.8747 68.3996 34.0988C67.2377 35.0433 65.7965 35.8033 64.2532 35.7022C62.9184 35.7022 61.7831 34.8764 60.874 33.989C62.1955 33.0664 62.7543 31.4849 63.1933 30.0176C63.9561 27.4345 64.302 24.7592 64.8608 22.1277C65.5481 19.3997 66.4439 16.5881 68.3464 14.4311" fill="#94C841"/>
      <mask id="mask2_40000949_1457" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="74" y="13" width="20" height="23">
      <path d="M77.127 13.9566C76.2888 14.5409 75.6014 15.3141 74.9983 16.1312C74.7766 16.3992 74.7012 16.7418 74.6436 17.0757C75.2378 17.6248 75.8187 18.1959 76.2622 18.8725C77.7212 21.0514 78.546 23.5554 79.362 26.0155C80.0361 28.0715 80.2667 30.2944 81.3665 32.1966C82.178 33.7166 83.5927 34.9598 85.2956 35.3727C87.4774 35.8999 89.8012 35.3068 91.6992 34.1954C92.3112 33.7912 93.003 33.409 93.3666 32.7457C92.2801 33.0927 91.0251 33.4837 89.9519 32.8819C88.5595 32.056 87.7213 30.5755 87.2202 29.0907C86.7013 27.6234 86.5639 26.0551 86.0716 24.579C85.4596 22.2112 84.6082 19.896 83.4286 17.7478C82.5505 16.1883 81.464 14.7078 80.0095 13.6316C79.8321 13.5173 79.6547 13.3768 79.4463 13.3372C78.6658 13.469 77.7966 13.4558 77.1358 13.9522" fill="white"/>
      </mask>
      <g mask="url(#mask2_40000949_1457)">
      <path d="M80.8989 4.59255L63.8896 28.3551L87.0922 44.6534L104.101 20.8909L80.8989 4.59255Z" fill="url(#paint2_linear_40000949_1457)"/>
      </g>
      <defs>
      <linearGradient id="paint0_linear_40000949_1457" x1="101.695" y1="13.0385" x2="91.8334" y2="29.9593" gradientUnits="userSpaceOnUse">
      <stop stop-color="#A2CC3A"/>
      <stop offset="1" stop-color="#71BF47"/>
      </linearGradient>
      <linearGradient id="paint1_linear_40000949_1457" x1="32.9991" y1="8.31833" x2="63.088" y2="29.856" gradientUnits="userSpaceOnUse">
      <stop stop-color="#96C842"/>
      <stop offset="1" stop-color="#369645"/>
      </linearGradient>
      <linearGradient id="paint2_linear_40000949_1457" x1="76.8026" y1="20.3745" x2="90.7774" y2="30.3777" gradientUnits="userSpaceOnUse">
      <stop stop-color="#84BA41"/>
      <stop offset="0.83" stop-color="#439C44"/>
      <stop offset="1" stop-color="#369645"/>
      </linearGradient>
      </defs>
      </svg>
    <div class="sidebar-brand">
      <span class="brand-main">WATEENFY</span>
      <span class="brand-tag">Simply Deliver!</span>
    </div>
  </div>
  <div class="sidebar-user">
    <div class="user-avatar">{{ getInitials() }}</div>
    <div class="user-info">
      <div class="user-name">{{ user?.name || 'User' }}
        <!-- <button class="user-edit" title="Edit">
          <svg width="18" height="18" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19.5 3 21l1.5-4L16.5 3.5z"/></svg>
        </button> -->
      </div>
      <div class="user-email">{{ user?.email || 'No email' }}</div>
    </div>
  </div>

  <!-- WhatsApp Status Indicator -->
  <div class="whatsapp-status" [ngClass]="getStatusClass()">
    <div class="status-icon">
      <svg *ngIf="!isWhatsAppReady()" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12,6 12,12 16,14"></polyline>
      </svg>
      <svg *ngIf="isWhatsAppReady()" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <polyline points="20,6 9,17 4,12"></polyline>
      </svg>
    </div>
    <div class="status-info">
      <span class="status-text">{{ getStatusText() }}</span>
      <span class="status-details" *ngIf="whatsappStatus">
        <span class="polling-status">{{ getPollingStatusText() }}</span>
        <span class="last-checked">{{ getLastCheckedText() }}</span>
      </span>
    </div>
    <button *ngIf="!isWhatsAppReady()" class="scan-status-btn" (click)="showQRCodePopup()" title="Scan QR Code">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
        <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
        <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
        <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
        <path d="M7 3v18"></path>
        <path d="M17 3v18"></path>
        <path d="M3 7h18"></path>
        <path d="M3 17h18"></path>
      </svg>
    </button>
  </div>

  <nav class="sidebar-menu">
    <a class="menu-item" routerLink="/dashboard" routerLinkActive="active"  [routerLinkActiveOptions]="{ exact: true }">
      <svg width="22" height="22" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="13" width="7" height="8" rx="1.5"/><rect x="14" y="3" width="7" height="18" rx="1.5"/></svg>
      Dashboard
    </a>
    <div class="menu-item whatsapp-menu" (click)="toggleWhatsappMenu($event)"  [class.active]="isWhatsAppTabActive()">
      <svg width="22" height="22" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-1.9 5.4 8.5 8.5 0 0 1-6.6 3.1 8.38 8.38 0 0 1-4.6-1.4L3 21l1.8-4.3A8.38 8.38 0 0 1 3.5 11.5a8.5 8.5 0 1 1 17 0z"/></svg>
      Whatsapp
      <svg class="chevron" width="18" height="18" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" [ngClass]="{open: whatsappMenuOpen}"><polyline points="6 9 12 15 18 9"/></svg>
    </div>
    <div class="submenu" *ngIf="whatsappMenuOpen">
    <a class="submenu-item" [routerLink]="isWhatsAppReady() ? ['/whatsapp/create-group'] : null"
      (click)="onCreateGroupClick($event)" [class.disabled]="!isWhatsAppReady()" routerLinkActive="active"
      [title]="!isWhatsAppReady() ? 'WhatsApp must be connected to create groups' : ''">
      Create Group
    </a>

      <a class="submenu-item" 
         routerLink="/whatsapp/list-groups" 
          routerLinkActive="active"
         (click)="$event.stopPropagation()">
        List Groups
      </a>
       <a class="submenu-item" [routerLink]="isWhatsAppReady() ? ['/whatsapp/member-management'] : null"
      (click)="onAddMemberClick($event)" [class.disabled]="!isWhatsAppReady()" routerLinkActive="active"
      [title]="!isWhatsAppReady() ? 'WhatsApp must be connected to add members' : ''">
     Member Management
    </a>
    <a class="submenu-item" [routerLink]="isWhatsAppReady() ? ['/whatsapp/add-member'] : null"
      (click)="onAddMemberClick($event)" [class.disabled]="!isWhatsAppReady()" routerLinkActive="active"
      [title]="!isWhatsAppReady() ? 'WhatsApp must be connected to add members' : ''">
      Add Member
    </a>

      <a class="submenu-item" 
         routerLink="/whatsapp/search-member" 
         routerLinkActive="active"
         (click)="$event.stopPropagation()">
        Search Member
      </a>
    </div>

    <div class="menu-item compose-menu" (click)="toggleComposeMenu($event)" [class.active]="isWhatsAppSendMessageTabActive()">
      <svg width="22" height="22" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M12 20h9" />
        <path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
      </svg>
      Compose
      <svg class="chevron" width="18" height="18" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" viewBox="0 0 24 24" [ngClass]="{open: composeMenuOpen}">
        <polyline points="6 9 12 15 18 9" />
      </svg>
    </div>
    
    <div class="submenu" *ngIf="composeMenuOpen">
      <a class="submenu-item" routerLink="/whatsapp/send-message" (click)="onSendMessageClick($event)"
      [routerLink]="isWhatsAppReady() ? ['/whatsapp/send-message'] : null"
      [class.disabled]="!isWhatsAppReady()" routerLinkActive="active"
      [title]="!isWhatsAppReady() ? 'WhatsApp must be connected to send message' : ''"
      >
        Send Message
      </a>
    </div>
    <a class="menu-item" routerLink="/logs" routerLinkActive="active"  [routerLinkActiveOptions]="{ exact: true }">
      <svg width="22" height="22" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      Logs
    </a>
    <a class="menu-item" routerLink="/admin-logout" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <svg width="22" height="22" fill="none" stroke="#3bbf6c" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
        <polyline points="16 17 21 12 16 7" />
        <line x1="21" y1="12" x2="9" y2="12" />
      </svg> Admin Logout
    </a>
  </nav>
  <div class="sidebar-bottom-image">
    <img src="assets/images/illustration_docs (1).png" alt="Message Logs Illustration">
  </div>

  <!-- QR Code Popup -->
  <app-qr-code-popup></app-qr-code-popup>
</aside>
